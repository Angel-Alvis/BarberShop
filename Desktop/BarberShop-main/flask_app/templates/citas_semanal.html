<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Agendar Cita | BarberShop</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/cita_semanal.css') }}"
    />
  </head>

  <body>
    <nav class="admin-nav">
      <div class="right text-end">
        <a href="/dashboard/usuario" class="btn btn-success">
          <i class="bi bi-arrow-left me-1"></i> Volver
        </a>
      </div>
    </nav>

    <div class="container mt-4">
      <h2 class="text-center mb-4">Agendar Cita</h2>

      <!-- Selección del barbero -->
      {% if not peluquero %}
      <div class="glass-card p-4 mx-auto" style="max-width: 600px">
        <h4 class="text-center mb-3">Seleccione un barbero</h4>

        <form method="get">
          <select class="form-select" name="peluquero_id" required>
            <option value="">-- Seleccionar --</option>
            {% for p in peluqueros %}
            <option value="{{ p.id }}">{{ p.nombre }} {{ p.apellido }}</option>
            {% endfor %}
          </select>

          <button class="btn btn-neon mt-3 w-100">Ver Disponibilidad</button>
        </form>
      </div>
      {% else %}

      <!-- Información del barbero -->
      <div class="glass-card p-3 mb-4 d-flex align-items-center">
        <img
          src="{{ url_for('static', filename=peluquero.imagen.url) }}"
          width="250"
          height="250"
          class="rounded shadow-neon me-3"
        />
        <div>
          <h4 class="m-1">{{ peluquero.nombre }} {{ peluquero.apellido }}</h4>
          {#<small>Semana: {{ semana.inicio }} → {{ semana.fin }}</small>#}
          
        </div>
      </div>

      <!-- CALENDARIO -->
      <div class="calendar-wrapper">
        {% for d, f in zip(dias, fechas) %}
          <div class="day-column">
            <h5 class="day-title">{{ d }}</h5>
            <p class="date-label">{{ f }}</p>

            {% for h in semana[d] %} 
              {% if h.reservado %}
                <div class="hour blocked">
                  {{ h.hora_inicio }} - {{ h.hora_fin }}
                </div>
              {% else %}
                <form method="post" action="/citas/agendar/procesar">
                  <input type="hidden" name="peluquero_id" value="{{ peluquero.id }}">
                  <input type="hidden" name="fecha" value="{{ h.fecha }}">
                  <input type="hidden" name="hora_inicio" value="{{ h.hora_inicio }}">
                  <input type="hidden" name="hora_fin" value="{{ h.hora_fin }}">
                  <input type="hidden" name="horario_id" value="{{ h.id }}">
                  <button class="hour available">{{ h.hora_inicio }} - {{ h.hora_fin }}</button>
                </form>
              {% endif %}
            {% endfor %}

          </div>
        {% endfor %}
      </div>

      {#<div class="calendar-wrapper">#}
        {#{% for d in semana.dias %}#}
        {#<div class="day-column">#}
          {#<h5 class="day-title">{{ d.dia }}</h5>#}
          {#<p class="date-label">{{ d.fecha }}</p>#}

          {#{% for h in d.horas %} {% if h.ocupado %}#}
          {#<div class="hour blocked">{{ h.hora }}</div>#}
          {#{% else %}#}
          {#<form method="post" action="/citas/agendar/procesar">#}
            {#<input#}
              {#type="hidden"#}
              {#name="peluquero_id"#}
              {#value="{{ peluquero.id }}"#}
            {#/>#}
            {#<input type="hidden" name="fecha" value="{{ d.fecha }}" />#}
            {#<input type="hidden" name="hora" value="{{ h.hora }}" />#}
            {#<button class="hour available">{{ h.hora }}</button>#}
          {#</form>#}
          {#{% endif %} {% endfor %}#}
        {#</div>#}
        {#{% endfor %}#}
      {#</div>#}

      {% endif %}
    </div>
  </body>
</html>
